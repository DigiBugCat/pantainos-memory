# Pantainos Memory Admin Worker
#
# Admin-only MCP server for maintenance and diagnostics.
# - CF Access enforced (admin users only)
# - MCP OAuth for protocol access
# - Shares D1/Vectorize bindings with API and MCP workers
#
# IMPORTANT: Terraform (infra/) is the source of truth for production.
# This file is used for `pnpm dev` (local) and `--env dev` only.

name = "pantainos-memory-admin"
main = "src/admin-index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# Production Environment (default)
# ============================================

# D1 Database (shared with API/MCP workers)
[[d1_databases]]
binding = "DB"
database_name = "pantainos-memory"
database_id = "22be27c1-7e29-4fac-81e2-cd96ceadafa2"

# Vectorize Indexes (shared)
[[vectorize]]
binding = "MEMORY_VECTORS"
index_name = "pantainos-memory-vectors"

[[vectorize]]
binding = "INVALIDATES_VECTORS"
index_name = "pantainos-memory-invalidates"

[[vectorize]]
binding = "CONFIRMS_VECTORS"
index_name = "pantainos-memory-confirms"

# Workers AI
[ai]
binding = "AI"

# OAuth KV
[[kv_namespaces]]
binding = "OAUTH_KV"
id = "44a53cd6bcbd4aadae45c51d1769b204"

# Analytics Engine
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "memory_admin_prod"

# Configuration Variables
[vars]
REASONING_MODEL = "@cf/openai/gpt-oss-120b"
DEDUP_MODEL = "@cf/openai/gpt-oss-20b"
DEDUP_THRESHOLD = "0.85"
RESOLVER_TYPE = "github"
RESOLVER_GITHUB_REPO = "DigiBugCat/Cassandra-Finance"

# ============================================
# Dev Environment
# ============================================
[env.dev]
name = "pantainos-memory-admin-dev"

[env.dev.ai]
binding = "AI"

[env.dev.vars]
REASONING_MODEL = "@cf/openai/gpt-oss-120b"
DEDUP_MODEL = "@cf/openai/gpt-oss-20b"
DEDUP_THRESHOLD = "0.85"
RESOLVER_TYPE = "github"
RESOLVER_GITHUB_REPO = "DigiBugCat/Cassandra-Finance"

# D1 Database
[[env.dev.d1_databases]]
binding = "DB"
database_name = "pantainos-memory-dev"
database_id = "cddfba98-685d-4139-933d-1160a00427c2"

# Vectorize Indexes
[[env.dev.vectorize]]
binding = "MEMORY_VECTORS"
index_name = "pantainos-memory-dev-vectors"

[[env.dev.vectorize]]
binding = "INVALIDATES_VECTORS"
index_name = "pantainos-memory-dev-invalidates"

[[env.dev.vectorize]]
binding = "CONFIRMS_VECTORS"
index_name = "pantainos-memory-dev-confirms"

# OAuth KV
[[env.dev.kv_namespaces]]
binding = "OAUTH_KV"
id = "8945fd577d87400c8f14dcfbd354aa88"

# Analytics Engine
[[env.dev.analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "memory_admin_dev"

# Local dev server
[dev]
port = 8796
local_protocol = "http"
